{% extends "base/base.html" %}
{% load static %}

{% block extra_css %}
    <link rel="stylesheet" href="{% static 'game-styles.css' %}">
{% endblock %}

{% block title %}Choose Initial Players{% endblock %}
{% block header %}Choose Initial Players{% endblock %}
{% block content %}
    <div class="panel setup-panel">
        <h2 class="mb-4">New Game Setup</h2>
        
        <form action="{% url 'lobby' %}" method="post">
            {% csrf_token %}
            
            <div class="color-picker-section">
                <label>Choose Your Color:</label>
                <input type="color" name="color" id="color" value="{{ form.color.value }}">
            </div>

            <div hx-ext="ws" ws-connect="/ws/game/default/">
                {% include 'game/partials/player_slots.html' %}
            </div>
        </form>

    </div>

    <div id="start-game-container" 
         class="mt-5 text-center"
         hx-get="." 
         hx-trigger="every 7s" 
         hx-select="#start-game-container" 
         hx-swap="outerHTML">
        {% if players.count >= MIN_PLAYERS %}
            <div style="display: flex; flex-direction: column; align-items: center; gap: 15px;">
                <a href="{% url 'game' %}" class="btn" style="font-size: 1.5rem; padding: 1rem 3rem; border-radius: 50px; font-weight: bold; text-transform: uppercase; letter-spacing: 2px;">Start Game</a>
                <a href="{% url 'reset_game' %}" class="btn btn-danger" style="background-color: #dc3545; border-color: #dc3545; font-size: 1rem; padding: 0.5rem 2rem; border-radius: 50px;">Reset Lobby</a>
            </div>
        {% else %}
            <div style="display: flex; flex-direction: column; align-items: center; gap: 15px;">
                <button class="btn btn-secondary" style="font-size: 1.5rem; padding: 1rem 3rem; border-radius: 50px; font-weight: bold; text-transform: uppercase; letter-spacing: 2px;" disabled>
                    Waiting for Players...
                </button>
                {% if players.count > 0 %}
                    <a href="{% url 'reset_game' %}" class="btn btn-danger" style="background-color: #dc3545; border-color: #dc3545; font-size: 1rem; padding: 0.5rem 2rem; border-radius: 50px;">Reset Lobby</a>
                {% endif %}
            </div>
        {% endif %}
    </div>
{% endblock %}